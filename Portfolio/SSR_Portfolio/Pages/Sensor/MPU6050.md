The MPU6050 is a sensor board that can read:
- The surrounding temperature
- Its acceleration
- Its rotation (based of a gyroscope)
The only thing needed from the MPU6050 is its gyroscope reading.

![[Datasheets/MPU-6050 Datasheet.pdf]]

# Communications
The MPU6050 supports I2C/TWI and listens to the 0x68 address.
Any settings that need to be programmed can be done via this interface.
## Used registers
The registers used are:
- **SMPLRT_DIV** (0x19): Sample rate divisor register
This register specifies the divider from the gyroscope output rate used to generate the Sample Rate. The Sample Rate is generated by dividing the gyroscope output rate by SMPLRT_DIV: 
$$Sample Rate = \frac{Gyroscope Output Rate}{1 + SMPLRT\_DIV}$$
The sample divider has been set to 0, to have the most accurate readings.
*page 11-12 of the MPU6050 datasheet*

- **CONFIG** (0x1A): General configuration register
The 3 LSB of this register represent the Digital Low Pass Filter (DLPF) . The accelerometer and gyroscope are filtered according to the value of DLPF_CFG.

The DLPF has been set to 8kHz to have the most accurate readings.
*page 13 of the MPU6050 datasheet*

- **GYRO_CONFIG** (0x1B): Gyro specfic configuration register
Bits 3 & 4 configure the full scale range (FS_SEL) of the gyroscope measuring. 

To save on data, needed to transmit, this value is set to have a range from -250° up to 250°. By then dividing the value by 2, the data only range of 250 data points, meaning it can be stored in a byte.
Since there are 3 dimensions, there is need for 3 bytes of gyroscope data.
*page 14 of the MPU6050 datasheet*

- **INT_ENABLE** (0x38): Interrupt enable configuration register
This register enables interrupt generation by interrupt sources.

Since there are no interrupt sources connected to the gyroscope, all interrupts will be disabled.
*page 28 of the MPU6050 datasheet*

- **GYRO_OUT** (0x43): Base address for gyroscope sensor data reads
These registers store the most recent gyroscope measurements.

Since the FS_SEL bits, in the **GYRO_CONFIG** register, are set to a range of -250° to +250°, the divider of the output data becomes 131:

$gyro data_{XYZ} = \frac{(GYRO\_OUT_{XYZ}\_H << 8) | GYRO\_OUT_{XYZ}\_L°}{131 \frac{LSB}{\frac{°}{s}}}$

*page 32 of the MPU6050 datasheet*

- **USER_CTRL** (0x6A): FIFO and I2C Master control register
This register allows the user to enable and disable the FIFO buffer, I2C Master Mode, and primary I2C interface.

Since the FIFO buffer is unused, it needs to bee disabled.
For the I2C the master mode needs to be disable, since this sensor is a slave module, but the primary I2C interface needs to be enable for communication (else SPI communication is enabled).
*page 39-40 of the MPU6050 datasheet*

- **PWR_MGMT_1** (0x6B): Primary power/sleep control register
This register allows the user to configure the power mode and clock source. Besides that, this register can also disable the temperature sensor.

The datasheet specifies that it is highly recommended to set a gyroscope axis as a reference for the clock when waking up. Since the z-axis data is what is desired of the module (to know if the Mars Rover is toppled), this axis will be chosen as a reference.

By setting bit 6 (SLEEP) of this register to 1, the module can be set to a low power sleep mode. It can be later woken up by setting the same bit back to 0.

Since this project doesn't use the temperature sensor of this module, it will be disable to save power. This can be done by setting the bit 3 (TEMP_DIS) of this register to 1.
*page 41 of the MPU6050 datasheet*

- **PWR_MGMT_2** (0x6C): Secondary power/sleep control register
This register allows the user to put individual axes of the accelerometer and gyroscope into standby mode.

Since this project doesn't use the accelerometer of this module, it will be disable to save power. This can be done by setting the bit 5 (STBY_XA), 4 (STBY_YA) and 3 (STBY_ZA) of this register to 1.
*page 43 of the MPU6050 datasheet*

# Data reading
All 3 data registers can be read using 1 I2C write/read command.
![[Images/I2C/mpu6050_i2c_message.png]]

## Reading problem
![[Videos/Sensor/mpu6050.mp4]]
As can be seen in the video, the MPU6050 gyroscope only measures the difference in angle as the module turns. This means that this module is not applicable for this project, since the measurements will have an interval of multiple minutes/hours (to conserve power).
# Power reading
This module is mounted to the LineBot and thus is connected to the $V_{AUX}$ of the Linebot. This means it has to either be dismounted from the LineBot, or powered via the battery of the LineBot.

When all sensors are fully acitve the module consumes around 5mA.
![[Images/I2C/mpu_all_sensors.png]]

By turning of the temperature sensor and the accelerometer, the consumption can be reduced to around 2.5mA.
![[Images/I2C/mpu_gyro_read.png]]

In sleep mode this module still consumes around 1.5mA making it unsuitable for low-power applications.
![[Images/I2C/mpu_full_sleep.png]]